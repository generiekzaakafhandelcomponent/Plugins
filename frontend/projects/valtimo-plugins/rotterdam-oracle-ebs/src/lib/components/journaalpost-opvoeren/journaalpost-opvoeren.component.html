 <!--
  ~ Copyright 2015-2025 Ritense BV, the Netherlands.
  ~
  ~ Licensed under EUPL, Version 1.2 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ https://joinup.ec.europa.eu/collection/eupl/eupl-text-eupl-12
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" basis,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<ng-container *ngIf="{
    disabled: disabled$ | async,
    prefill: prefillConfiguration$ ? (prefillConfiguration$ | async) : null
} as obs">
<!--
    <v-form (valueChange)="formValueChange($event)">
        <v-input
            type="text"
            name="procesCode"
            required="true"
            margin="true"
            [title]="'procesCode' | pluginTranslate: pluginId | async"
            [disabled]="obs.disabled"
            [defaultValue]="obs.prefill?.procesCode"
            [tooltip]="'procesCodeTooltip' | pluginTranslate: pluginId | async"
        >
        </v-input>
        <v-input
            type="text"
            name="referentieNummer"
            required="true"
            margin="true"
            [title]="'referentieNummer' | pluginTranslate: pluginId | async"
            [disabled]="obs.disabled"
            [defaultValue]="obs.prefill?.referentieNummer"
            [tooltip]="'referentieNummerTooltip' | pluginTranslate: pluginId | async"
        >
        </v-input>
        <v-input
            type="text"
            name="sleutel"
            required="true"
            margin="true"
            [title]="'sleutel' | pluginTranslate: pluginId | async"
            [disabled]="obs.disabled"
            [defaultValue]="obs.prefill?.sleutel"
            [tooltip]="'sleutelTooltip' | pluginTranslate: pluginId | async"
        >
        </v-input>
        <v-input
            type="text"
            name="boekdatumTijd"
            required="true"
            margin="true"
            [title]="'boekdatumTijd' | pluginTranslate: pluginId | async"
            [disabled]="obs.disabled"
            [defaultValue]="obs.prefill?.boekdatumTijd"
            [tooltip]="'boekdatumTijdTooltip' | pluginTranslate: pluginId | async"
        >
        </v-input>
        <v-input
            type="text"
            name="categorie"
            required="true"
            margin="true"
            [title]="'categorie' | pluginTranslate: pluginId | async"
            [disabled]="obs.disabled"
            [defaultValue]="obs.prefill?.categorie"
            [tooltip]="'categorieTooltip' | pluginTranslate: pluginId | async"
        >
        </v-input>
        <v-select
            name="saldoSoort"
            required="true"
            margin="true"
            [title]="'saldoSoort' | pluginTranslate: pluginId | async"
            [disabled]="obs.disabled"
            [defaultSelectionId]="obs.prefill?.saldoSoort"
            [tooltip]="'saldoSoortTooltip' | pluginTranslate: pluginId | async"
            [items]="saldoSoortItems"
        >
        </v-select>
        <v-input
            type="text"
            name="omschrijving"
            required="true"
            margin="true"
            [title]="'omschrijving' | pluginTranslate: pluginId | async"
            [disabled]="obs.disabled"
            [defaultValue]="obs.prefill?.omschrijving"
            [tooltip]="'omschrijvingTooltip' | pluginTranslate: pluginId | async"
        >
        </v-input>
        <v-input
            type="digitOnly"
            name="boekjaar"
            required="false"
            margin="true"
            maxLength="4"
            [title]="'boekjaar' | pluginTranslate: pluginId | async"
            [disabled]="obs.disabled"
            [defaultValue]="obs.prefill?.boekjaar.toString()"
            [tooltip]="'boekjaarTooltip' | pluginTranslate: pluginId | async"
        >
        </v-input>
        <v-input
            type="digitOnly"
            name="boekperiode"
            required="false"
            margin="true"
            maxLength="4"
            [title]="'boekperiode' | pluginTranslate: pluginId | async"
            [disabled]="obs.disabled"
            [defaultValue]="obs.prefill?.boekperiode.toString()"
            [tooltip]="'boekperiodeTooltip' | pluginTranslate: pluginId | async"
        >
        </v-input>
    </v-form>
-->

    <form [formGroup]="pluginActionForm">
        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'procesCode',
                title: 'procesCode',
                tooltip: 'procesCodeTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'referentieNummer',
                title: 'referentieNummer',
                tooltip: 'referentieNummerTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'sleutel',
                title: 'sleutel',
                tooltip: 'sleutelTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'boekdatumTijd',
                title: 'boekdatum',
                tooltip: 'boekdatumTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'categorie',
                title: 'categorie',
                tooltip: 'categorieTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="selectFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'saldoSoort',
                title: 'saldoSoort',
                tooltip: 'saldoSoortTooltip',
                required: true,
                items: saldoSoortItems
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'omschrijving',
                title: 'omschrijving',
                tooltip: 'omschrijvingTooltip'
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'boekjaar',
                title: 'boekjaar',
                tooltip: 'boekjaarTooltip'
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'boekperiode',
                title: 'boekperiode',
                tooltip: 'boekperiodeTooltip',
                required: true
            }"
        />

        <div>
            <v-input-label
                required="true"
                [title]="'journaalpostRegels' | pluginTranslate: pluginId | async"
                [tooltip]="'journaalpostTooltip' | pluginTranslate: pluginId | async"
            >
            </v-input-label>
            <div formArrayName="regels" class="lines-wrapper">
                <div class="line-wrapper"
                     *ngFor="let line of lines.controls; let i = index">
                    <ng-container
                        [ngTemplateOutlet]="lineInputFieldTemplate"
                        [ngTemplateOutletContext]="{
                            formGroup: line,
                            controlName: 'grootboekSleutel',
                            title: 'grootboekSleutel',
                            required: true
                        }"
                    />
                    <ng-container
                        [ngTemplateOutlet]="lineSelectFieldTemplate"
                        [ngTemplateOutletContext]="{
                            formGroup: line,
                            controlName: 'boekingType',
                            title: 'boekingType',
                            required: true,
                            items: linesBoekingTypeItems[i]
                        }"
                    />
                    <ng-container
                        [ngTemplateOutlet]="lineInputFieldTemplate"
                        [ngTemplateOutletContext]="{
                            formGroup: line,
                            controlName: 'omschrijving',
                            title: 'regelOmschrijving'
                        }"
                    />
                    <ng-container
                        [ngTemplateOutlet]="lineInputFieldTemplate"
                        [ngTemplateOutletContext]="{
                            formGroup: line,
                            controlName: 'bedrag',
                            title: 'bedrag',
                            required: true
                        }"
                    />
                    <div class="remove-line-wrapper">
                        <button type="button"
                                cdsButton="secondary"
                                (click)="removeLine(i)"
                                [disabled]="obs.disabled"
                        >
                            {{'regelVerwijderen' | pluginTranslate: pluginId | async}}
                            <svg class="cds--btn__icon" cdsIcon="subtract" size="16"></svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="add-line-wrapper">
                <button type="button"
                        cdsButton="secondary"
                        (click)="addLine()"
                        [disabled]="obs.disabled">
                    {{'regelToevoegen' | pluginTranslate: pluginId | async}}
                    <svg class="cds--btn__icon" cdsIcon="add" size="16"></svg>
                </button>
            </div>
        </div>
    </form>

</ng-container>

<ng-template #inputFieldTemplate
    let-formGroup="formGroup"
    let-controlName="controlName"
    let-type="type ?? 'text'"
    let-title="title"
    let-tooltip="tooltip"
    let-required="required ?? false">
    <div [formGroup]="formGroup" class="field-wrapper">
        <v-input-label
            [title]="title | pluginTranslate: pluginId | async"
            [tooltip]="tooltip | pluginTranslate: pluginId | async"
            [required]="required"
        >
        </v-input-label>
        <input cdsText
               [type]="type"
               [formControlName]="controlName">
    </div>
</ng-template>

 <ng-template #selectFieldTemplate
    let-formGroup="formGroup"
    let-controlName="controlName"
    let-title="title"
    let-tooltip="tooltip"
    let-required="required ?? false"
    let-items="items ?? []">
    <div [formGroup]="formGroup" class="field-wrapper">
        <v-input-label
            [title]="title | pluginTranslate: pluginId | async"
            [tooltip]="tooltip | pluginTranslate: pluginId | async"
            [required]="required"
        >
        </v-input-label>
        <cds-dropdown [formControlName]="controlName">
            <cds-dropdown-list [items]="items"></cds-dropdown-list>
        </cds-dropdown>
    </div>
</ng-template>

<ng-template #lineInputFieldTemplate
    let-formGroup="formGroup"
    let-controlName="controlName"
    let-type="type ?? 'text'"
    let-title="title"
    let-required="required ?? false">
    <div [formGroup]="formGroup" class="line-field-wrapper">
        <v-input-label
            [title]="title | pluginTranslate: pluginId | async"
            [required]="required"
        >
        </v-input-label>
        <input cdsText
               [type]="type"
               [formControlName]="controlName">
    </div>
</ng-template>

<ng-template #lineSelectFieldTemplate
    let-formGroup="formGroup"
    let-controlName="controlName"
    let-title="title"
    let-required="required ?? false"
    let-items="items ?? []">
    <div [formGroup]="formGroup" class="line-field-wrapper">
        <v-input-label
            [title]="title | pluginTranslate: pluginId | async"
            [required]="required"
        >
        </v-input-label>
        <cds-dropdown [formControlName]="controlName">
            <cds-dropdown-list [items]="items"></cds-dropdown-list>
        </cds-dropdown>
    </div>
</ng-template>
