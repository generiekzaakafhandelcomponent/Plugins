 <!--
  ~ Copyright 2015-2025 Ritense BV, the Netherlands.
  ~
  ~ Licensed under EUPL, Version 1.2 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ https://joinup.ec.europa.eu/collection/eupl/eupl-text-eupl-12
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" basis,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<ng-container *ngIf="{
    disabled: disabled$ | async,
    prefill: prefillConfiguration$ ? (prefillConfiguration$ | async) : null
} as obs">
    <form [formGroup]="pluginActionForm">
        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'procesCode',
                title: 'procesCode',
                tooltip: 'procesCodeTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'referentieNummer',
                title: 'referentieNummer',
                tooltip: 'referentieNummerTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'sleutel',
                title: 'sleutel',
                tooltip: 'sleutelTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'boekdatumTijd',
                title: 'boekdatum',
                tooltip: 'boekdatumTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'categorie',
                title: 'categorie',
                tooltip: 'categorieTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="selectFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'saldoSoort',
                title: 'saldoSoort',
                tooltip: 'saldoSoortTooltip',
                placeholder: 'saldoSoortPlaceholder',
                required: true,
                items: saldoSoortItems
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'omschrijving',
                title: 'omschrijving',
                tooltip: 'omschrijvingTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'boekjaar',
                title: 'boekjaar',
                tooltip: 'boekjaarTooltip',
                required: true
            }"
        />

        <ng-container
            [ngTemplateOutlet]="inputFieldTemplate"
            [ngTemplateOutletContext]="{
                formGroup: pluginActionForm,
                controlName: 'boekperiode',
                title: 'boekperiode',
                tooltip: 'boekperiodeTooltip',
                required: true
            }"
        />

        <div>
            <v-input-label
                required="true"
                [title]="'journaalpostRegels' | pluginTranslate: pluginId | async"
                [tooltip]="'journaalpostTooltip' | pluginTranslate: pluginId | async"
            >
            </v-input-label>
            <div formArrayName="regels" class="lines-wrapper">
                <div class="line-wrapper"
                     *ngFor="let line of lines.controls; let i = index">
                    <ng-container
                        [ngTemplateOutlet]="lineInputFieldTemplate"
                        [ngTemplateOutletContext]="{
                            formGroup: line,
                            controlName: 'grootboekSleutel',
                            title: 'grootboekSleutel',
                            required: true
                        }"
                    />
                    <ng-container
                        [ngTemplateOutlet]="lineSelectFieldTemplate"
                        [ngTemplateOutletContext]="{
                            formGroup: line,
                            controlName: 'boekingType',
                            title: 'boekingType',
                            placeholder: 'boekingTypePlaceholder',
                            required: true,
                            items: boekingTypeItems
                        }"
                    />
                    <ng-container
                        [ngTemplateOutlet]="lineInputFieldTemplate"
                        [ngTemplateOutletContext]="{
                            formGroup: line,
                            controlName: 'omschrijving',
                            title: 'regelOmschrijving'
                        }"
                    />
                    <ng-container
                        [ngTemplateOutlet]="lineInputFieldTemplate"
                        [ngTemplateOutletContext]="{
                            formGroup: line,
                            controlName: 'bedrag',
                            title: 'bedrag',
                            required: true
                        }"
                    />
                    <div class="remove-line-wrapper">
                        <button type="button"
                                cdsButton="secondary"
                                (click)="removeLine(i)"
                                [disabled]="obs.disabled"
                        >
                            {{'regelVerwijderen' | pluginTranslate: pluginId | async}}
                            <svg class="cds--btn__icon" cdsIcon="subtract" size="16"></svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="add-line-wrapper">
                <button type="button"
                        cdsButton="secondary"
                        (click)="addLine()"
                        [disabled]="obs.disabled">
                    {{'regelToevoegen' | pluginTranslate: pluginId | async}}
                    <svg class="cds--btn__icon" cdsIcon="add" size="16"></svg>
                </button>
            </div>
        </div>
    </form>

</ng-container>

<ng-template #inputFieldTemplate
    let-formGroup="formGroup"
    let-controlName="controlName"
    let-type="type ?? 'text'"
    let-title="title"
    let-tooltip="tooltip"
    let-required="required ?? false">
    <div [formGroup]="formGroup" class="field-wrapper">
        <v-input-label
            [title]="title | pluginTranslate: pluginId | async"
            [tooltip]="tooltip | pluginTranslate: pluginId | async"
            [required]="required"
        >
        </v-input-label>
        <input cdsText
               [type]="type"
               [formControlName]="controlName">
    </div>
</ng-template>

 <ng-template #selectFieldTemplate
    let-formGroup="formGroup"
    let-controlName="controlName"
    let-title="title"
    let-tooltip="tooltip"
    let-placeholder="placeholder"
    let-required="required ?? false"
    let-items="items ?? []">
    <div [formGroup]="formGroup" class="field-wrapper">
        <v-input-label
            [title]="title | pluginTranslate: pluginId | async"
            [tooltip]="tooltip | pluginTranslate: pluginId | async"
            [required]="required"
        >
        </v-input-label>
        <cds-select [formControlName]="controlName">
            <option value="default" disabled selected>{{ placeholder | pluginTranslate: pluginId | async }}</option>
            <option *ngFor="let item of items" [value]="item">{{ item }}</option>
        </cds-select>
    </div>
</ng-template>

<ng-template #lineInputFieldTemplate
    let-formGroup="formGroup"
    let-controlName="controlName"
    let-type="type ?? 'text'"
    let-title="title"
    let-required="required ?? false">
    <div [formGroup]="formGroup" class="line-field-wrapper">
        <v-input-label
            [title]="title | pluginTranslate: pluginId | async"
            [required]="required"
        >
        </v-input-label>
        <input cdsText
               [type]="type"
               [formControlName]="controlName">
    </div>
</ng-template>

<ng-template #lineSelectFieldTemplate
    let-formGroup="formGroup"
    let-controlName="controlName"
    let-title="title"
    let-placeholder="placeholder"
    let-required="required ?? false"
    let-items="items ?? []">
    <div [formGroup]="formGroup" class="line-field-wrapper">
        <v-input-label
            [title]="title | pluginTranslate: pluginId | async"
            [required]="required"
        >
        </v-input-label>
        <cds-select [formControlName]="controlName">
            <option value="default" disabled selected>{{ placeholder | pluginTranslate: pluginId | async }}</option>
            <option *ngFor="let item of items" [value]="item">{{ item }}</option>
        </cds-select>
    </div>
</ng-template>
